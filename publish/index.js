!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("prop-types"),require("react")):"function"==typeof define&&define.amd?define(["prop-types","react"],t):"object"==typeof exports?exports.index=t(require("prop-types"),require("react")):e.index=t(e.PropTypes,e.React)}(this,function(e,t){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return-1!==e.indexOf(".")},n=function(e,t){var r=e.split("."),o=r[0],n=r[1];if(!n)throw new Error("Invalid style name.");if(!t[o])throw new Error("CSS module import does not exist.");if(!t[o][n])throw new Error("CSS module does not exist.");return t[o][n]};t.default=function(e,t){var r=Object.keys(t);return e?e.split(" ").filter(function(e){return e}).map(function(e){if(o(e))return n(e,t);if(0===r.length)throw new Error("Cannot use styleName attribute without importing at least one stylesheet.");if(r.length>1)throw new Error("Cannot use anonymous style name with more than one stylesheet import.");var a=t[r[0]];return a[e]?a[e]:(console.warn("Could not resolve the styleName '"+e+"' in '"+r+"' file."),"")}).join(" "):""}},function(e,t){},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),l=r(0),c=o(l),f=r(3),u=o(f),h=r(2),d=o(h);r(1);var p={"./index.scss":{drag:"index__drag___3PHTT",loadingCircle:"index__loadingCircle___3Mda1",items:"index__items___3R1zt",refresh:"index__refresh___2CKLL",loadNext:"index__loadNext___2C7KC",loading:"index__loading___TheRf",success:"index__success___f4lp0",error:"index__error___38eWT",hide:"index__hide___1kUw1",toTop:"index__toTop___y0GiH"}},_=function(e){function t(){var e,r,o,s;n(this,t);for(var i=arguments.length,l=Array(i),c=0;c<i;c++)l[c]=arguments[c];return r=o=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),o.state={dragY:0,dragTransition:"",refreshIcon:"",refreshTxt:"",refreshDeg:"",loadNextIcon:"",loadNextTxt:"",showToTop:!1},o.maxOver=50,o.scrollRate=.5,o.tStart=0,o.loadFlag=!1,o.refreshFlag=!1,o.nextFlag=!0,o.scrollFlag=!1,o.haveData=!0,o.toTopTimer=0,s=r,a(o,s)}return s(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this.props.refresh;"function"==typeof e&&e();var t=this.drag,r=this.start,o=this.move,n=this.end;t.addEventListener("touchstart",r.bind(this),{passive:!1}),t.addEventListener("touchmove",o.bind(this),{passive:!1}),t.addEventListener("touchend",n.bind(this),{passive:!1})}},{key:"scroll",value:function(){var e=this;this.scrollFlag=!1;var t=this.child,r=this.loadFlag,o=this.props,n=this.nextFlag;"function"==typeof o.loadNext&&!r&&n&&.9*(t.scrollHeight-t.offsetHeight)<t.scrollTop&&(this.loadFlag=!0,this.setState({loadNextIcon:"loading",loadNextTxt:"加载中..."}),o.loadNext().then(function(t){e.setState({loadNextIcon:"success",loadNextTxt:"加载成功"})}).catch(function(t){e.setState({loadNextIcon:"error",loadNextTxt:"加载失败"}),e.nextFlag=!1,console.error(t)}).finally(function(t){e.loadFlag=!1})),this.setState({showToTop:t.scrollTop>t.offsetHeight})}},{key:"start",value:function(e){var t=this.loadFlag,r=(this.drag,this.tStart,this.child),o=this.toTopTimer;clearInterval(o),t||(0===r.scrollTop&&(this.scrollFlag=!0),this.setState({refreshIcon:"",dragTransition:"none"}),this.tStart=e.touches[0].clientY)}},{key:"move",value:function(e){var t=this.loadFlag,r=this.maxOver,o=this.scrollRate,n=this.tStart,a=this.scrollFlag,s=this.child,i=this.haveData;if(!t&&i)if(0===s.scrollTop)if(a){var l=(n-e.touches[0].clientY)*o;l<0?(e.preventDefault(),this.refreshFlag=r<Math.abs(l),this.setState({refreshDeg:"rotate("+(this.refreshFlag?180:0)+"deg)",refreshTxt:this.refreshFlag?"释放更新":"下拉刷新",dragY:Math.abs(l)})):this.refreshFlag=!1}else this.start(e);else this.refreshFlag=!1}},{key:"end",value:function(e){var t=this,r=this.maxOver,o=this.loadFlag,n=(this.drag,this.refreshFlag),a=this.props.refresh;return o?void e.preventDefault():(this.setState({dragTransition:"330ms"}),n&&"function"==typeof a?(this.refreshFlag=!1,this.setState({dragY:r,refreshIcon:"loading",refreshTxt:"加载中",refreshDeg:"rotate(0deg)"}),a().then(function(e){t.setState({refreshIcon:"success",refreshTxt:"加载成功"})}).catch(function(e){t.setState({refreshIcon:"error",refreshTxt:"加载失败"}),console.error(e)}).finally(function(e){setTimeout(function(){t.setState({dragY:0}),setTimeout(function(){t.setState({dragTransition:"none"}),t.loadFlag=!1},330)},1e3)})):this.setState({dragY:0}),!0)}},{key:"toTop",value:function(){var e=this,t=this.child;this.toTopTimer=setInterval(function(){t.scrollTop=.99*t.scrollTop,t.scrollTop<=1&&(t.scrollTop=0,clearInterval(e.toTopTimer))},1)}},{key:"render",value:function(){var e=this,t=this.state,r=t.dragY,o=t.dragTransition,n=t.refreshIcon,a=t.refreshTxt,s=t.refreshDeg,i=t.loadNextIcon,l=t.loadNextTxt,f=t.showToTop,h=this.props,d=h.height,_=h.refresh,g=h.loadNext,x=h.children,v=x.props?x.props.children.length:x.length;return this.haveData=v>0,u.default.createElement("div",{className:"index__drag___3PHTT",style:{height:d,transition:o,WebkitTransition:o,transform:"translate3d(0px, "+r+"px, 0px)",WebkitTransform:"translate3d(0px, "+r+"px, 0px)"},ref:function(t){e.drag=t}},u.default.createElement("div",{className:(0,c.default)(("function"==typeof _?"":"hide")+" refresh",p)},u.default.createElement("span",{style:{transform:s,WebkitTransform:s},className:(0,c.default)(n,p)}),u.default.createElement("label",null,a)),u.default.createElement("div",{className:"index__items___3R1zt",ref:function(t){e.child=t},style:{height:d},onScroll:this.scroll.bind(this)},x,u.default.createElement("div",{className:(0,c.default)(("function"==typeof g?"":"hide")+" loadNext",p)},u.default.createElement("span",{className:(0,c.default)(i,p)}),u.default.createElement("label",null,l))),u.default.createElement("div",{onClick:this.toTop.bind(this),className:(0,c.default)((f?"":"hide")+" toTop",p)},"TOP"))}}]),t}(f.Component);_.propTypes={height:d.default.string.isRequired,refresh:d.default.func,loadNext:d.default.func},_.defaultProps={height:"",refresh:null,loadNext:null},t.default=_}])});